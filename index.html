<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª</title>

  <!-- Webã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ -->
  <link rel="icon" type="image/png" sizes="192x192" href="./images/icons/atonankai-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="./images/icons/atonankai-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./images/icons/atonankai-512.png">

  <!-- PWAç”¨ï¼ˆå¿…è¦ãªã‚‰ï¼‰ -->
  <link rel="manifest" href="./manifest.webmanifest">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PZZ71NWCL2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PZZ71NWCL2');
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'M PLUS Rounded 1c', 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    .hidden { display: none; }

    /* è»Š */
    .car-icon { transition: transform 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 0.8s ease-out; cursor: pointer; }
    .car-icon.departing { transform: translateX(150vw) rotate(10deg); opacity: 0; }

    /* ãŠã—ã¾ã„ */
    .finish-popup { animation: bounce-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    @keyframes bounce-in { 0% { opacity:0; transform: scale(0.3);} 100%{opacity:1; transform: scale(1);} }

    /* é¢¨èˆ¹ï¼šã·ã‚‹ã·ã‚‹ */
    @keyframes wobble {
      0%   { transform: translateY(0) rotate(0deg) scale(var(--balloonScale, 1)); }
      15%  { transform: translateY(-2px) rotate(-2deg) scale(var(--balloonScale, 1)); }
      30%  { transform: translateY(1px) rotate(2deg) scale(var(--balloonScale, 1)); }
      45%  { transform: translateY(-2px) rotate(-1deg) scale(var(--balloonScale, 1)); }
      60%  { transform: translateY(1px) rotate(2deg) scale(var(--balloonScale, 1)); }
      75%  { transform: translateY(-1px) rotate(-2deg) scale(var(--balloonScale, 1)); }
      100% { transform: translateY(0) rotate(0deg) scale(var(--balloonScale, 1)); }
    }
    .wobble { animation: wobble 0.45s ease-in-out infinite; transform-origin: 50% 80%; }

    /* é¢¨èˆ¹ï¼šè­¦å‘Šã¡ã‹ã¡ã‹ï¼ˆæœ¬ä½“ãŒäº¤äº’ã«å¼·èª¿ï¼‰ */
    @keyframes warningFlash {
      0%, 100% { filter: none; }
      50% { filter: brightness(1.2) saturate(1.4) drop-shadow(0 0 16px rgba(239,68,68,0.55)); }
    }
    .warning { animation: warningFlash 0.55s ease-in-out infinite; }

    /* â˜…ã‚«ãƒ¼ãƒ‰å¤–æ ï¼šèµ¤æ ã¡ã‹ã¡ã‹ï¼ˆé¢¨èˆ¹ã«éš ã‚Œãªã„ï¼‰ */
    @keyframes alertFrameFlash {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); }
      50% { box-shadow: 0 0 0 12px rgba(239,68,68,0.9); }
    }
    .alert-frame {
      animation: alertFrameFlash 0.6s ease-in-out infinite;
      border-radius: 1.5rem; /* rounded-2xlç›¸å½“ */
    }

    /* é¸æŠUI */
    .choice-radio:checked + .choice-card {
      outline: 3px solid rgba(236,72,153,0.45);
      box-shadow: 0 10px 30px rgba(236,72,153,0.18);
      transform: translateY(-1px);
    }

    /* â˜…æ±—ï¼šãƒã‚¿ãƒã‚¿ï¼ˆSVGå†…ãƒ†ã‚­ã‚¹ãƒˆã«åŠ¹ãï¼‰ */
    .drip {
      transform-box: fill-box;
      transform-origin: center;
      animation: dripFall 1.1s ease-in-out infinite;
    }
    .drip.d2 { animation-delay: 0.22s; }
    .drip.d3 { animation-delay: 0.44s; }

    @keyframes dripFall {
      0%   { transform: translateY(-2px); opacity: 0; }
      12%  { opacity: 1; }
      70%  { opacity: 1; }
      100% { transform: translateY(18px); opacity: 0; }
    }
  </style>
</head>

<body class="bg-orange-50 text-gray-800 min-h-screen">
  <div class="min-h-screen flex flex-col items-center justify-center px-4">
    <header class="mb-6">
      <img src="./images/logo/logo-atonankai-header.png" alt="ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª ãƒ­ã‚´" class="h-24 mx-auto">
    </header>

    <div id="app-container" class="w-full max-w-md mx-auto">

      <!-- è¨­å®š -->
      <div id="settings-screen" class="p-6 bg-white rounded-2xl shadow-lg space-y-6">
        <h1 class="text-2xl font-bold text-center text-amber-600">ã˜ã‚…ã‚“ã³</h1>

        <div>
          <label for="title-input" class="block text-sm font-medium text-gray-700 mb-1">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input type="text" id="title-input" placeholder="ä¾‹ï¼šã™ã¹ã‚Šã ã„"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500">
        </div>

        <div>
          <label for="photo-input" class="block text-sm font-medium text-gray-700 mb-1">ã—ã‚ƒã—ã‚“</label>
          <input type="file" id="photo-input" accept="image/*"
                 class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100 cursor-pointer">
          <img id="photo-preview" class="hidden mt-4 rounded-lg max-h-40 mx-auto" src="" alt="Photo preview">
        </div>

        <!-- ã‚ã¨ãªã‚“ã‹ã„ -->
        <div class="space-y-3">
          <label for="count-input" class="block text-sm font-medium text-gray-700 mb-1">ãªã‚“ã‹ã„ï¼Ÿ</label>
          <div class="flex items-center justify-center space-x-4">
            <button id="decrement" class="px-4 py-2 bg-amber-400 text-white rounded-full font-bold text-lg">-</button>
            <input type="number" id="count-input" value="3" min="1" max="20"
                   class="w-20 text-center text-xl font-bold border-transparent focus:outline-none focus:ring-0">
            <button id="increment" class="px-4 py-2 bg-amber-400 text-white rounded-full font-bold text-lg">+</button>
          </div>

          <button id="start-btn"
                  class="w-full py-3 bg-orange-500 text-white font-bold rounded-lg shadow-md hover:bg-orange-600 transition-colors text-lg">
            ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¹ã‚¿ãƒ¼ãƒˆ
          </button>
        </div>

        <!-- ãµã†ã›ã‚“ã‚¿ã‚¤ãƒãƒ¼ï¼ˆ1ã€œ5ï¼‰ -->
        <div class="space-y-3 pt-2 border-t">
          <label for="balloon-minutes" class="block text-sm font-medium text-gray-700 mb-1">
            ãµã†ã›ã‚“ã‚¿ã‚¤ãƒãƒ¼ï¼ˆ1ã€œ5ã·ã‚“ï¼‰
          </label>

          <div class="flex items-center justify-center space-x-4">
            <button id="balloonDec" class="px-4 py-2 bg-pink-400 text-white rounded-full font-bold text-lg">-</button>
            <input type="number" id="balloon-minutes" value="3" min="1" max="5"
                   class="w-20 text-center text-xl font-bold border-transparent focus:outline-none focus:ring-0">
            <button id="balloonInc" class="px-4 py-2 bg-pink-400 text-white rounded-full font-bold text-lg">+</button>
          </div>

          <!-- 3ç¨®é¸æŠ -->
          <div class="mt-2">
            <p class="text-sm font-medium text-gray-700 mb-2">ã©ã‚Œã«ã™ã‚‹ï¼Ÿ</p>

            <div class="grid grid-cols-3 gap-2">
              <label class="block">
                <input class="choice-radio hidden" type="radio" name="balloonType" value="round" checked>
                <div class="choice-card rounded-2xl border bg-white px-2 py-2 text-center shadow-sm transition">
                  <div class="mx-auto w-14 h-14 flex items-center justify-center">
                    <svg viewBox="0 0 120 140" class="w-14 h-14">
                      <path d="M60 92 C 40 112, 75 118, 55 136" fill="none" stroke="#64748b" stroke-width="3" stroke-linecap="round"/>
                      <path d="M60 78 L50 90 L70 90 Z" fill="#fb7185"/>
                      <path d="M60 8 C 92 8, 112 32, 112 62 C 112 96, 86 118, 60 118 C 34 118, 8 96, 8 62 C 8 32, 28 8, 60 8 Z" fill="#fb7185"/>
                      <path d="M44 26 C 34 40, 34 58, 44 76" fill="none" stroke="white" stroke-opacity="0.55" stroke-width="8" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <div class="text-xs font-bold text-slate-700">ãµã†ã›ã‚“</div>
                </div>
              </label>

              <label class="block">
                <input class="choice-radio hidden" type="radio" name="balloonType" value="car">
                <div class="choice-card rounded-2xl border bg-white px-2 py-2 text-center shadow-sm transition">
                  <div class="mx-auto w-14 h-14 flex items-center justify-center">
                    <svg viewBox="0 0 140 140" class="w-14 h-14">
                      <path d="M70 94 C 50 114, 85 120, 65 138" fill="none" stroke="#64748b" stroke-width="3" stroke-linecap="round"/>
                      <path d="M70 82 L58 96 L82 96 Z" fill="#60a5fa"/>
                      <rect x="20" y="20" rx="28" ry="28" width="100" height="78" fill="#60a5fa"/>
                      <path d="M36 54 Q70 18 104 54" fill="#60a5fa" opacity="0.95"/>
                      <circle cx="52" cy="88" r="10" fill="#334155" opacity="0.9"/>
                      <circle cx="98" cy="88" r="10" fill="#334155" opacity="0.9"/>
                      <circle cx="52" cy="88" r="4" fill="#e2e8f0"/>
                      <circle cx="98" cy="88" r="4" fill="#e2e8f0"/>
                      <circle cx="52" cy="58" r="6" fill="#0f172a" opacity="0.9"/>
                      <circle cx="88" cy="58" r="6" fill="#0f172a" opacity="0.9"/>
                      <path d="M60 72 Q70 80 80 72" fill="none" stroke="#0f172a" stroke-width="5" stroke-linecap="round"/>
                      <path d="M38 40 h64" stroke="white" stroke-opacity="0.4" stroke-width="8" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <div class="text-xs font-bold text-slate-700">ãã‚‹ã¾</div>
                </div>
              </label>

              <label class="block">
                <input class="choice-radio hidden" type="radio" name="balloonType" value="strawberry">
                <div class="choice-card rounded-2xl border bg-white px-2 py-2 text-center shadow-sm transition">
                  <div class="mx-auto w-14 h-14 flex items-center justify-center">
                    <svg viewBox="0 0 140 140" class="w-14 h-14">
                      <path d="M70 94 C 50 114, 85 120, 65 138" fill="none" stroke="#64748b" stroke-width="3" stroke-linecap="round"/>
                      <path d="M70 82 L58 96 L82 96 Z" fill="#f43f5e"/>
                      <path d="M70 18 C 98 18, 116 40, 116 66 C 116 104, 92 120, 70 124 C 48 120, 24 104, 24 66 C 24 40, 42 18, 70 18 Z" fill="#f43f5e"/>
                      <path d="M46 20 C 54 12, 62 10, 70 18 C 78 10, 86 12, 94 20 C 84 26, 76 28, 70 26 C 64 28, 56 26, 46 20 Z" fill="#22c55e"/>
                      <g fill="#ffe4e6" opacity="0.9">
                        <ellipse cx="52" cy="60" rx="4" ry="6"/>
                        <ellipse cx="70" cy="56" rx="4" ry="6"/>
                        <ellipse cx="88" cy="60" rx="4" ry="6"/>
                        <ellipse cx="60" cy="78" rx="4" ry="6"/>
                        <ellipse cx="80" cy="78" rx="4" ry="6"/>
                        <ellipse cx="70" cy="96" rx="4" ry="6"/>
                      </g>
                      <path d="M46 38 C 36 52, 36 72, 46 90" fill="none" stroke="white" stroke-opacity="0.35" stroke-width="10" stroke-linecap="round"/>
                      <circle cx="58" cy="86" r="5" fill="#0f172a" opacity="0.9"/>
                      <circle cx="82" cy="86" r="5" fill="#0f172a" opacity="0.9"/>
                      <path d="M62 98 Q70 105 78 98" fill="none" stroke="#0f172a" stroke-width="5" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <div class="text-xs font-bold text-slate-700">ã„ã¡ã”</div>
                </div>
              </label>
            </div>
          </div>

          <button id="balloonStartBtn"
                  class="w-full py-3 bg-pink-500 text-white font-bold rounded-lg shadow-md hover:bg-pink-600 transition-colors text-lg">
            ğŸˆ ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ
          </button>
        </div>
      </div>

      <!-- è»Šãƒ¡ã‚¤ãƒ³ -->
      <div id="main-screen" class="hidden text-center">
        <h2 id="display-title" class="text-3xl font-bold mb-4 text-amber-700"></h2>
        <img id="display-photo" class="hidden mb-6 rounded-lg shadow-md max-h-60 mx-auto" src="" alt="Uploaded photo">
        <div id="car-container" class="flex flex-wrap justify-center items-center gap-4 mb-8"></div>
        <button id="reset-btn" class="py-2 px-6 bg-white text-amber-600 border-2 border-amber-500 font-bold rounded-lg shadow-sm hover:bg-amber-50 transition-colors">
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>

      <!-- é¢¨èˆ¹ç”»é¢ -->
      <div id="balloon-screen" class="hidden">
        <!-- â˜…ã‚«ãƒ¼ãƒ‰ã«IDä»˜ä¸ï¼ˆå¤–æ è­¦å‘Šç”¨ï¼‰ -->
        <div id="balloonCard" class="p-6 bg-white rounded-2xl shadow-lg">
          <div class="flex items-center justify-between">
            <div class="font-bold text-slate-700">â± ã‚¿ã‚¤ãƒãƒ¼</div>
            <div class="text-2xl font-black tabular-nums text-slate-900" id="balloonTimer">03:00</div>
          </div>

          <!-- è¦–è¦šãƒ¡ãƒ¼ã‚¿ãƒ¼ -->
          <div class="mt-3">
            <div class="w-full h-4 bg-slate-200 rounded-full overflow-hidden">
              <div id="timeMeter"
                   class="h-full rounded-full transition-all duration-300"
                   style="width:100%; background-color:#34d399;">
              </div>
            </div>
          </div>

          <p class="mt-4 text-center text-slate-700 font-bold">
            ã˜ã‚…ã‚“ã³ãŒã§ããŸã‚‰ <span class="text-pink-600">ã‚¿ãƒƒãƒ—</span>ã—ã¦ ã‚ã‚ã†ï¼
          </p>

          <div class="mt-1 text-center text-xs font-bold text-slate-500" id="balloonTypeLabel">ï¼ˆãµã†ã›ã‚“ï¼‰</div>

          <div class="mt-6 flex items-center justify-center">
            <button id="balloonBtn" class="relative select-none touch-manipulation" aria-label="ãµã†ã›ã‚“ã‚’ã‚ã‚‹">
              <div id="balloonWrap" class="relative will-change-transform"></div>

              <div id="tapBadge"
                   class="absolute -top-4 left-1/2 -translate-x-1/2 px-3 py-1 rounded-full bg-white/90 border text-sm font-bold text-slate-700 shadow">
                ã‚¿ãƒƒãƒ—ï¼
              </div>
            </button>
          </div>

          <div class="mt-8 grid gap-3">
            <button id="balloonRestart" class="w-full rounded-2xl bg-slate-900 text-white py-3 text-lg font-bold shadow active:scale-[0.99]">
              ã‚‚ã†ã„ã¡ã©
            </button>
            <button id="balloonBack" class="w-full rounded-2xl bg-white text-slate-900 py-3 text-lg font-bold border shadow-sm active:scale-[0.99]">
              ã‚‚ã©ã‚‹
            </button>
          </div>
        </div>
      </div>

      <!-- è»Šï¼šãŠã—ã¾ã„ -->
      <div id="finish-message" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="finish-popup bg-white p-12 rounded-3xl shadow-2xl text-center">
          <span class="text-6xl mb-4 inline-block">ğŸ‰</span>
          <p class="text-5xl font-bold text-orange-500">ãŠã—ã¾ã„ï¼</p>
        </div>
        <!-- â˜…è¿½åŠ ï¼šè»Šå´ã®ç´™å¹é›ªã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <canvas id="carConfettiCanvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
</div>
    </div>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼å›ºå®š -->
  <div id="footer-fixed" class="fixed bottom-4 right-4 flex flex-col items-end space-y-2 z-50">
    <div id="logo-container" class="flex items-center space-x-2 opacity-75">
      <img src="./Flogo2.png" alt="ãƒ­ã‚´" class="h-10 w-10 rounded-full object-cover">
      <p class="text-xs text-gray-600 font-semibold">ä¸€èˆ¬ç¤¾å›£æ³•äººç¦ç¥‰ã§ã¤ãªãŒã‚‹ä¼š</p>
    </div>
    <button id="contactButton" class="bg-yellow-200 border border-gray-300 shadow-md px-4 py-2 rounded-lg text-sm">
      å•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰
    </button>
  </div>

  <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="feedbackForm" class="fixed bottom-28 right-4 bg-white border border-gray-300 rounded-lg shadow-xl p-4 w-72 z-50 hidden">
    <h3 class="text-lg mb-3 font-bold">ãŠå•ã„åˆã‚ã›</h3>
    <form id="feedbackSubmitForm">
      <label class="text-sm">ã‚¢ãƒ—ãƒªã‚’é¸æŠï¼ˆå¿…é ˆï¼‰</label>
      <select id="appName" required class="w-full border rounded px-2 py-1 mb-3 text-sm">
        <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª">ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª</option>
        <option value="ãƒªãƒ•ãƒ¬ãƒŸãƒ¼">ãƒªãƒ•ãƒ¬ãƒŸãƒ¼</option>
        <option value="ã»ã‚ã‚¹ã‚¿">ã»ã‚ã‚¹ã‚¿</option>
        <option value="ã‚ã–ã›ãƒªãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼">ã‚ã–ã›ãƒªãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼</option>
      </select>

      <label class="text-sm">ç¨®åˆ¥</label>
      <select id="feedbackType" class="w-full border rounded px-2 py-1 mb-3 text-sm">
        <option>ãƒã‚°å ±å‘Š</option>
        <option>è¦æœ›</option>
        <option>è³ªå•</option>
        <option>ãã®ä»–</option>
      </select>

      <label class="text-sm">å†…å®¹</label>
      <textarea id="content" class="w-full border rounded px-2 py-1 mb-3 text-sm h-20" required></textarea>

      <label class="text-sm">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰</label>
      <input id="email" type="email" class="w-full border rounded px-2 py-1 mb-3 text-sm">

      <button type="submit" class="w-full bg-orange-300 py-2 rounded-lg text-sm font-bold mb-2">é€ä¿¡</button>
      <button type="button" id="closeFeedback" class="w-full bg-gray-200 py-2 rounded-lg text-sm">é–‰ã˜ã‚‹</button>
    </form>

    <div id="feedbackThanks" class="hidden text-center">
      <p class="mb-4">é€ä¿¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
      <button type="button" id="closeThanks" class="w-full bg-gray-200 py-2 rounded-lg text-sm">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <!-- ãŠç¥ã„ï¼ˆbodyç›´ä¸‹ï¼‰ -->
  <div id="celebrateOverlay" class="hidden fixed inset-0 z-[9999] bg-black/30 backdrop-blur-sm">
    <div class="min-h-full flex items-center justify-center p-4 relative z-10">
      <div class="w-full max-w-md rounded-3xl bg-white shadow-xl p-6 text-center">
        <div class="text-5xl">ğŸ‰</div>
        <div class="mt-3 text-2xl font-black text-slate-900">ã™ã”ã„ã€‚ã‚ˆãã§ããŸã­ã€‚</div>
        <p class="mt-2 text-slate-600 font-bold">ãŠã‚ã§ã¨ã†ï¼</p>
        <button id="celebrateClose" class="mt-5 w-full rounded-2xl bg-pink-500 text-white py-3 text-lg font-bold shadow active:scale-[0.99]">
          OK
        </button>
      </div>
    </div>
    <canvas id="confettiCanvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
  </div>

  <!-- å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ JS -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const contactButton = document.getElementById("contactButton");
      const feedbackForm = document.getElementById("feedbackForm");
      const closeFeedback = document.getElementById("closeFeedback");
      const feedbackSubmitForm = document.getElementById("feedbackSubmitForm");
      const feedbackThanks = document.getElementById("feedbackThanks");
      const closeThanks = document.getElementById("closeThanks");

      contactButton.addEventListener("click", () => feedbackForm.classList.remove("hidden"));
      closeFeedback.addEventListener("click", () => feedbackForm.classList.add("hidden"));

      feedbackSubmitForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const appName = document.getElementById("appName").value;
        const feedbackType = document.getElementById("feedbackType").value;
        const content = document.getElementById("content").value;
        const email = document.getElementById("email").value;

        if (!appName) { alert("ã‚¢ãƒ—ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"); return; }

        const subject = encodeURIComponent(`[${appName}] å•ã„åˆã‚ã›: ${feedbackType}`);
        const body = encodeURIComponent(
          `ã‚¢ãƒ—ãƒªï¼š${appName}\nç¨®åˆ¥ï¼š${feedbackType}\n\nå†…å®¹ï¼š\n${content}\n\nãƒ¡ãƒ¼ãƒ«ï¼š${email || "æœªè¨˜å…¥"}`
        );

        window.location.href = `mailto:info.fukushi@allcare.co.jp?subject=${subject}&body=${body}`;
        feedbackSubmitForm.classList.add("hidden");
        feedbackThanks.classList.remove("hidden");
      });

      closeThanks.addEventListener("click", () => {
        feedbackForm.classList.add("hidden");
        feedbackSubmitForm.classList.remove("hidden");
        feedbackThanks.classList.add("hidden");
        feedbackSubmitForm.reset();
      });
    });
  </script>

  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“JS -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {

      // ===== DOM =====
      const timeMeter = document.getElementById('timeMeter');
      const settingsScreen = document.getElementById('settings-screen');
      const mainScreen = document.getElementById('main-screen');
      const balloonScreen = document.getElementById('balloon-screen');
      const balloonCard = document.getElementById('balloonCard');

      const titleInput = document.getElementById('title-input');
      const countInput = document.getElementById('count-input');
      const startBtn = document.getElementById('start-btn');

      const displayTitle = document.getElementById('display-title');
      const carContainer = document.getElementById('car-container');
      const resetBtn = document.getElementById('reset-btn');
      const finishMessage = document.getElementById('finish-message');

      const decrementBtn = document.getElementById('decrement');
      const incrementBtn = document.getElementById('increment');

      const photoInput = document.getElementById('photo-input');
      const photoPreview = document.getElementById('photo-preview');
      const displayPhoto = document.getElementById('display-photo');

      const carConfettiCanvas = document.getElementById('carConfettiCanvas');

      // Balloon settings
      const balloonMinutesInput = document.getElementById('balloon-minutes');
      const balloonDec = document.getElementById('balloonDec');
      const balloonInc = document.getElementById('balloonInc');
      const balloonStartBtn = document.getElementById('balloonStartBtn');

      // Balloon screen
      const balloonTimerEl = document.getElementById('balloonTimer');
      const balloonBtn = document.getElementById('balloonBtn');
      const balloonWrap = document.getElementById('balloonWrap');
      const tapBadge = document.getElementById('tapBadge');
      const balloonRestart = document.getElementById('balloonRestart');
      const balloonBack = document.getElementById('balloonBack');
      const balloonTypeLabel = document.getElementById('balloonTypeLabel');

      // Celebrate
      const celebrateOverlay = document.getElementById('celebrateOverlay');
      const celebrateClose = document.getElementById('celebrateClose');
      const confettiCanvas = document.getElementById('confettiCanvas');

      // ===== è»Š =====
      let remainingCount = 0;

      function createCarSVG(number) {
        return `
        <svg viewBox="0 0 140 100" class="w-20 h-20 sm:w-24 sm:h-24">
          <g stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 60 Q20 40 40 35 H85 Q105 35 120 55 Q124 60 122 70 Q120 82 108 84 H32 Q20 82 18 72 Q16 66 18 60 Z"
              fill="currentColor" opacity="0.9" />
            <path d="M40 35 Q55 18 75 18 Q95 18 108 35"
              fill="none" stroke="currentColor" stroke-width="4" opacity="0.35" />
            <rect x="47" y="30" width="46" height="24" rx="10" ry="10"
              fill="none" stroke="#ffffff" stroke-width="2.2" opacity="0.7" />
            <circle cx="60" cy="43" r="9" fill="#ffffff" />
            <circle cx="80" cy="43" r="9" fill="#ffffff" />
            <circle cx="60" cy="43" r="4.8" fill="#333333" />
            <circle cx="80" cy="43" r="4.8" fill="#333333" />
            <path d="M63 53 Q70 57 77 53" fill="none" stroke="#ffffff" stroke-width="2.8" />
            <circle cx="42" cy="80" r="9.5" fill="#555555" />
            <circle cx="96" cy="80" r="9.5" fill="#555555" />
            <circle cx="42" cy="80" r="4.5" fill="#e5e5e5" opacity="0.85" />
            <circle cx="96" cy="80" r="4.5" fill="#e5e5e5" opacity="0.85" />
            <text x="50%" y="78%" text-anchor="middle" font-size="32" font-weight="bold"
              fill="#ffffff" stroke="#000000" stroke-width="2"
              style="font-family: 'M PLUS Rounded 1c', sans-serif;">${number}</text>
          </g>
        </svg>`;
      }

      const carColors = [
        'text-sky-300','text-emerald-300','text-amber-300','text-pink-300',
        'text-violet-300','text-lime-300','text-orange-300','text-teal-300'
      ];

      photoInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          photoPreview.src = e.target.result;
          photoPreview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      });

      decrementBtn.addEventListener('click', () => {
        let v = parseInt(countInput.value);
        if (v > parseInt(countInput.min)) countInput.value = v - 1;
      });
      incrementBtn.addEventListener('click', () => {
        let v = parseInt(countInput.value);
        if (v < parseInt(countInput.max)) countInput.value = v + 1;
      });

      startBtn.addEventListener('click', () => {
        const title = titleInput.value.trim() === '' ? '' : titleInput.value;
        const count = parseInt(countInput.value);
        const photoSrc = photoPreview.src;

        if (count > 0) {
          setupMainScreen(title, count, photoSrc);
          settingsScreen.classList.add('hidden');
          balloonScreen.classList.add('hidden');
          mainScreen.classList.remove('hidden');
        }
      });

      function setupMainScreen(title, count, photoSrc) {
        displayTitle.textContent = `${title} ã‚ã¨ ${count}ã‹ã„`;

        if (photoSrc && photoSrc !== window.location.href) {
          displayPhoto.src = photoSrc;
          displayPhoto.classList.remove('hidden');
        } else {
          displayPhoto.classList.add('hidden');
        }

        carContainer.innerHTML = '';
        remainingCount = count;

        for (let i = 0; i < count; i++) {
          const carWrapper = document.createElement('div');
          carWrapper.innerHTML = createCarSVG(i + 1);
          carWrapper.className = `car-icon ${carColors[i % carColors.length]}`;
          carWrapper.addEventListener('click', carClickListener);
          carContainer.appendChild(carWrapper);
        }
      }

      function carClickListener(event) {
        const car = event.currentTarget;
        if (car.classList.contains('departing')) return;

        car.classList.add('departing');
        remainingCount--;

        setTimeout(() => { car.style.visibility = 'hidden'; }, 800);

        if (remainingCount > 0) {
          displayTitle.textContent = `ã‚ã¨ ${remainingCount}ã‹ã„`;
        } else {
  displayTitle.textContent = 'ã‚ˆãã§ãã¾ã—ãŸï¼';
  setTimeout(() => {
    finishMessage.classList.remove('hidden');

    // â˜…è¿½åŠ ï¼šè»Šå´ã®ç´™å¹é›ªé–‹å§‹
    requestAnimationFrame(() => runConfetti(carConfettiCanvas));
  }, 1000);
}
        car.removeEventListener('click', carClickListener);
      }

      resetBtn.addEventListener('click', () => {
        mainScreen.classList.add('hidden');
        balloonScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
        titleInput.value = '';
        photoInput.value = '';
        photoPreview.src = '';
        photoPreview.classList.add('hidden');
      });

      finishMessage.addEventListener('click', () => {
        stopConfetti(); // â˜…è¿½åŠ 
        finishMessage.classList.add('hidden');
        mainScreen.classList.add('hidden');
        balloonScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
        titleInput.value = '';
        photoInput.value = '';
        photoPreview.src = '';
        photoPreview.classList.add('hidden');
      });

      // ===== é¢¨èˆ¹ï¼šè¨­å®šï¼ˆ1ã€œ5ï¼‰ =====
      function clampMinutes(v) { return Math.min(5, Math.max(1, v)); }

      balloonDec.addEventListener('click', () => {
        balloonMinutesInput.value = clampMinutes(parseInt(balloonMinutesInput.value || '3') - 1);
      });
      balloonInc.addEventListener('click', () => {
        balloonMinutesInput.value = clampMinutes(parseInt(balloonMinutesInput.value || '3') + 1);
      });
      balloonMinutesInput.addEventListener('change', () => {
        balloonMinutesInput.value = clampMinutes(parseInt(balloonMinutesInput.value || '3'));
      });

      // ===== é¢¨èˆ¹ã‚¿ã‚¤ãƒ— =====
      function getSelectedBalloonType() {
        const checked = document.querySelector('input[name="balloonType"]:checked');
        return checked ? checked.value : 'round';
      }
      function typeLabel(type) {
        if (type === 'car') return 'ï¼ˆãã‚‹ã¾ãµã†ã›ã‚“ï¼‰';
        if (type === 'strawberry') return 'ï¼ˆã„ã¡ã”ãµã†ã›ã‚“ï¼‰';
        return 'ï¼ˆãµã†ã›ã‚“ï¼‰';
      }

      // â˜…æ±—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…±é€šï¼ˆSVGå†…ã«é…ç½®ï¼‰
      function sweatLayerSVG() {
        // ã“ã“ã¯ã€Œé¢¨èˆ¹ã®å³ä¸Šã‚ãŸã‚Šã€ã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚ä½ç½®ã¯å¾Œã§å¾®èª¿æ•´OKã€‚
        return `
          <g id="sweatLayer" opacity="0">
            <text class="drip d1" x="190" y="95" font-size="32">ğŸ’§</text>
          </g>
        `;
      }

      function balloonSVG(type) {
        if (type === 'car') {
          return `
            <svg width="260" height="300" viewBox="0 0 260 300" class="drop-shadow-xl">
              <path d="M132 200 C 105 228, 155 238, 122 285" fill="none" stroke="#64748b" stroke-width="4" stroke-linecap="round"/>
              <path d="M132 184 L116 202 L148 202 Z" fill="#60a5fa"/>
              <rect x="55" y="40" rx="48" ry="48" width="150" height="120" fill="#60a5fa"/>
              <path d="M78 98 Q130 36 182 98" fill="#60a5fa" opacity="0.95"/>
              <circle cx="92" cy="156" r="14" fill="#334155" opacity="0.9"/>
              <circle cx="168" cy="156" r="14" fill="#334155" opacity="0.9"/>
              <circle cx="92" cy="156" r="6" fill="#e2e8f0"/>
              <circle cx="168" cy="156" r="6" fill="#e2e8f0"/>
              <circle cx="104" cy="112" r="8" fill="#0f172a" opacity="0.9"/>
              <circle cx="156" cy="112" r="8" fill="#0f172a" opacity="0.9"/>
              <path d="M116 132 Q130 146 144 132" fill="none" stroke="#0f172a" stroke-width="7" stroke-linecap="round"/>
              <path d="M82 66 h96" stroke="white" stroke-opacity="0.35" stroke-width="12" stroke-linecap="round"/>
              ${sweatLayerSVG()}
            </svg>
          `;
        }

        if (type === 'strawberry') {
          return `
            <svg width="260" height="300" viewBox="0 0 260 300" class="drop-shadow-xl">
              <path d="M132 200 C 105 228, 155 238, 122 285" fill="none" stroke="#64748b" stroke-width="4" stroke-linecap="round"/>
              <path d="M132 184 L116 202 L148 202 Z" fill="#f43f5e"/>
              <path d="M130 44 C 182 44, 214 82, 214 126 C 214 190, 170 214, 130 222 C 90 214, 46 190, 46 126 C 46 82, 78 44, 130 44 Z" fill="#f43f5e"/>
              <path d="M86 50 C 102 34, 116 32, 130 46 C 144 32, 158 34, 174 50 C 156 62, 142 66, 130 62 C 118 66, 104 62, 86 50 Z" fill="#22c55e"/>
              <g fill="#ffe4e6" opacity="0.95">
                <ellipse cx="100" cy="118" rx="5" ry="8"/>
                <ellipse cx="130" cy="110" rx="5" ry="8"/>
                <ellipse cx="160" cy="118" rx="5" ry="8"/>
                <ellipse cx="112" cy="150" rx="5" ry="8"/>
                <ellipse cx="148" cy="150" rx="5" ry="8"/>
                <ellipse cx="130" cy="182" rx="5" ry="8"/>
              </g>
              <path d="M88 86 C 72 110, 72 146, 88 170" fill="none" stroke="white" stroke-opacity="0.32" stroke-width="14" stroke-linecap="round"/>
              <circle cx="116" cy="164" r="7" fill="#0f172a" opacity="0.9"/>
              <circle cx="144" cy="164" r="7" fill="#0f172a" opacity="0.9"/>
              <path d="M120 178 Q130 188 140 178" fill="none" stroke="#0f172a" stroke-width="7" stroke-linecap="round"/>
              ${sweatLayerSVG()}
            </svg>
          `;
        }

        // round
        return `
          <svg width="260" height="300" viewBox="0 0 260 300" class="drop-shadow-xl">
            <path d="M132 200 C 105 228, 155 238, 122 285" fill="none" stroke="#64748b" stroke-width="4" stroke-linecap="round"/>
            <path d="M132 184 L116 202 L148 202 Z" fill="#fb7185"/>
            <path d="M130 30 C 195 30, 230 82, 230 140 C 230 205, 178 240, 130 240 C 82 240, 30 205, 30 140 C 30 82, 65 30, 130 30 Z" fill="#fb7185"/>
            <path d="M92 70 C 70 104, 70 140, 92 176" fill="none" stroke="white" stroke-opacity="0.55" stroke-width="14" stroke-linecap="round"/>
            <circle cx="108" cy="158" r="9" fill="#0f172a" opacity="0.9"/>
            <circle cx="152" cy="158" r="9" fill="#0f172a" opacity="0.9"/>
            <path d="M118 182 Q130 198 142 182" stroke="#0f172a" stroke-width="7" fill="none" stroke-linecap="round"/>
            ${sweatLayerSVG()}
          </svg>
        `;
      }

      // ===== é¢¨èˆ¹ã‚¿ã‚¤ãƒãƒ¼æœ¬ä½“ =====
      let popped = false;
      let balloonRaf = 0;
      let balloonStartAt = 0;
      let balloonDurationMs = 3 * 60 * 1000;
      let currentBalloonType = 'round';

      const BALLOON_START_SCALE = 0.65;
      const BALLOON_END_SCALE   = 1.85;

      // çµ‚ç›¤æ¼”å‡ºï¼š30ç§’/30ç§’/60ç§’/60ç§’ï¼ˆåˆè¨ˆ180ç§’ï¼‰
      let stageApplied = -1;
      const STAGE_TOTAL_MS = 180000;

      function stageFromEndgameElapsed(ms, endgameTotal) {
  // 30/30/60/60ï¼ˆåˆè¨ˆ180ç§’ï¼‰ã‚’ã€endgameTotal ã«æ¯”ä¾‹ç¸®å°ã™ã‚‹
  const t1 = endgameTotal * (30 / 180);   // â‘ çµ‚ã‚ã‚Š
  const t2 = endgameTotal * (60 / 180);   // â‘¡çµ‚ã‚ã‚Š
  const t3 = endgameTotal * (120 / 180);  // â‘¢çµ‚ã‚ã‚Š

  if (ms < t1) return 0;   // â‘ æ±—1æ»´
  if (ms < t2) return 1;   // â‘¡æ±—ã„ã£ã±ã„
  if (ms < t3) return 2;   // â‘¢ã·ã‚‹ã·ã‚‹
  return 3;                // â‘£èµ¤æ 
}

      function fmtMMSS(ms) {
        const total = Math.max(0, Math.ceil(ms / 1000));
        const m = String(Math.floor(total / 60)).padStart(2, '0');
        const s = String(total % 60).padStart(2, '0');
        return `${m}:${s}`;
      }

      function setBalloonScale(scale) {
        balloonWrap.style.setProperty('--balloonScale', String(scale));
        if (!balloonWrap.classList.contains('wobble')) {
          balloonWrap.style.transform = `scale(${scale})`;
        }
      }

      function renderBalloon(type) {
        balloonWrap.innerHTML = balloonSVG(type);
        balloonTypeLabel.textContent = typeLabel(type);
      }

      function getSweatLayer() {
        return balloonWrap.querySelector('#sweatLayer');
      }

      // â˜…æ®µéšã”ã¨ã®æ±—HTMLï¼ˆSVGå†…ï¼‰
      function setSweat(stage) {
        const sweat = getSweatLayer();
        if (!sweat) return;

        if (stage < 0) {
          sweat.setAttribute('opacity', '0');
          sweat.innerHTML = `<text class="drip d1" x="190" y="95" font-size="32">ğŸ’§</text>`;
          return;
        }

        sweat.setAttribute('opacity', '1');

        if (stage === 0) {
          // â‘  1æ»´
          sweat.innerHTML = `<text class="drip d1" x="190" y="95" font-size="32">ğŸ’§</text>`;
          return;
        }

        // â‘¡ ã„ã£ã±ã„ï¼ˆ3æ»´ï¼‰
        sweat.innerHTML = `
          <text class="drip d1" x="190" y="95" font-size="32">ğŸ’§</text>
          <text class="drip d2" x="168" y="115" font-size="28">ğŸ’§</text>
          <text class="drip d3" x="205" y="120" font-size="28">ğŸ’§</text>
        `;
      }

      function clearActions() {
        setSweat(-1);
        balloonWrap.classList.remove('wobble');
        balloonWrap.classList.remove('warning');
        balloonCard.classList.remove('alert-frame');
      }

      function resetBalloonVisual() {
        popped = false;
        tapBadge.classList.remove('hidden');

        balloonWrap.style.transition = '';
        balloonWrap.style.opacity = '1';
        balloonWrap.style.filter = 'none';

        stageApplied = -1;
        clearActions();

        setBalloonScale(BALLOON_START_SCALE);
        balloonTimerEl.textContent = fmtMMSS(balloonDurationMs);

        // ãƒ¡ãƒ¼ã‚¿ãƒ¼åˆæœŸåŒ–
        timeMeter.style.width = '100%';
        timeMeter.style.backgroundColor = '#34d399';
      }

      function applyStage(stage) {
        if (stage === stageApplied) return;
        stageApplied = stage;

        // ã„ã£ãŸã‚“å¤–ã—ã¦ã‹ã‚‰ä»˜ã‘ç›´ã—
        clearActions();

        // æ±—
        if (stage >= 0) setSweat(stage);

        // â‘¢ã·ã‚‹ã·ã‚‹
        if (stage >= 2) balloonWrap.classList.add('wobble');

        // â‘£ã‚«ãƒ¼ãƒ‰å¤–æ è­¦å‘Š
        if (stage >= 3) balloonCard.classList.add('alert-frame');
      }

      function startBalloonGrowth() {
        cancelAnimationFrame(balloonRaf);
        balloonStartAt = performance.now();

        const tick = (now) => {
          const elapsed = now - balloonStartAt;
          const t = Math.min(1, elapsed / balloonDurationMs);

          // ãµã‚“ã‚ã‚ŠeaseOut
          const eased = 1 - Math.pow(1 - t, 3);
          const scale = BALLOON_START_SCALE + (BALLOON_END_SCALE - BALLOON_START_SCALE) * eased;

          const remaining = balloonDurationMs - elapsed;
          balloonTimerEl.textContent = fmtMMSS(remaining);

          // è¦–è¦šãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°
          const progress = Math.max(0, 1 - elapsed / balloonDurationMs);
          timeMeter.style.width = `${progress * 100}%`;
          if (progress > 0.66) timeMeter.style.backgroundColor = '#34d399';
          else if (progress > 0.33) timeMeter.style.backgroundColor = '#fbbf24';
          else timeMeter.style.backgroundColor = '#ef4444';

          setBalloonScale(scale);

          // çµ‚ç›¤æ¼”å‡ºï¼ˆæ®‹ã‚Šæ™‚é–“ãƒ™ãƒ¼ã‚¹ï¼šæœ€å¾Œã®180ç§’ã€çŸ­ã„è¨­å®šãªã‚‰å…¨æ™‚é–“ï¼‰
          const endgameTotal = Math.min(balloonDurationMs, STAGE_TOTAL_MS);
          const endgameStartElapsed = balloonDurationMs - endgameTotal;

          if (elapsed < endgameStartElapsed) {
            if (stageApplied !== -1) {
              stageApplied = -1;
              clearActions();
            }
          } else {
            const endgameElapsed = elapsed - endgameStartElapsed;
            const stageWanted = stageFromEndgameElapsed(endgameElapsed, endgameTotal);
            applyStage(stageWanted);
          }

          balloonRaf = requestAnimationFrame(tick);
        };

        balloonRaf = requestAnimationFrame(tick);
      }

      function openBalloonScreen() {
        settingsScreen.classList.add('hidden');
        mainScreen.classList.add('hidden');
        balloonScreen.classList.remove('hidden');
      }

      function popBalloon() {
        if (popped) return;
        popped = true;

        tapBadge.classList.add('hidden');

        // å‰²ã‚Œã‚‹ç›´å‰ã«ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
        cancelAnimationFrame(balloonRaf);

        // æ¼”å‡ºåœæ­¢
        clearActions();

        // ã•ã£ã¨ç¸®ã‚“ã§æ¶ˆãˆã‚‹
        balloonWrap.style.transition = 'transform 220ms ease, opacity 220ms ease, filter 220ms ease';
        balloonWrap.style.transform = `scale(${BALLOON_START_SCALE})`;
        balloonWrap.style.opacity = '0';
        balloonWrap.style.filter = 'blur(2px)';

        setTimeout(() => { openCelebrate(); }, 180);
      }

      // ===== ç´™å¹é›ªï¼ˆå…±é€šåŒ–ï¼‰ =====
let confettiRaf = 0;
let confettiParticles = [];

function setupConfetti(canvas) {
  const dpr = devicePixelRatio || 1;
  canvas.width = Math.floor(canvas.clientWidth * dpr);
  canvas.height = Math.floor(canvas.clientHeight * dpr);

  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  return ctx;
}

function makeConfettiBurst(canvas) {
  confettiParticles = [];
  const count = 140;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;

  for (let i = 0; i < count; i++) {
    confettiParticles.push({
      x: w / 2,
      y: h * 0.35,
      vx: (Math.random() * 10 - 5),
      vy: (Math.random() * -10 - 2),
      g: 0.18 + Math.random() * 0.14,
      r: 2 + Math.random() * 4,
      a: 1,
      spin: (Math.random() * 0.25 - 0.125),
      rot: Math.random() * Math.PI,
      c: ['#fb7185','#60a5fa','#34d399','#fbbf24','#a78bfa'][Math.floor(Math.random()*5)]
    });
  }
}

function runConfetti(canvas) {
  const ctx = setupConfetti(canvas);
  makeConfettiBurst(canvas);

  cancelAnimationFrame(confettiRaf);

  const draw = () => {
    ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);

    confettiParticles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += p.g;
      p.a *= 0.992;
      p.rot += p.spin;

      ctx.save();
      ctx.globalAlpha = Math.max(0, p.a);
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.c;
      ctx.fillRect(-p.r, -p.r, p.r * 2.2, p.r * 1.4);
      ctx.restore();
    });

    confettiParticles = confettiParticles.filter(p => p.a > 0.08 && p.y < canvas.clientHeight + 40);
    if (confettiParticles.length > 0) confettiRaf = requestAnimationFrame(draw);
  };

  confettiRaf = requestAnimationFrame(draw);
}

function stopConfetti() {
  cancelAnimationFrame(confettiRaf);
}

// ===== é¢¨èˆ¹ï¼šãŠç¥ã„ï¼ˆå¾©æ´»ï¼‰ =====
function openCelebrate() {
  // é¢¨èˆ¹å‰²ã£ãŸå¾Œã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
  celebrateOverlay.classList.remove('hidden');

  // Canvasã®ã‚µã‚¤ã‚ºãŒDOMåæ˜ ã•ã‚Œã¦ã‹ã‚‰ç´™å¹é›ªé–‹å§‹
  requestAnimationFrame(() => runConfetti(confettiCanvas));
}

function closeCelebrate() {
  // é¢¨èˆ¹å´ã®ç´™å¹é›ªåœæ­¢ï¼†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—éè¡¨ç¤º
  stopConfetti();
  celebrateOverlay.classList.add('hidden');
}

// ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚­ãƒ£ãƒ³ãƒã‚¹ã ã‘ãƒªã‚»ãƒƒãƒˆï¼ˆç´™å¹é›ªã‚’ç¶šã‘ãŸã„å ´åˆã«ã‚‚å¯¾å¿œï¼‰
function resizeConfetti() {
  setupConfetti(confettiCanvas);
}


      // ===== é¢¨èˆ¹ï¼šé–‹å§‹/æ“ä½œ =====
      balloonStartBtn.addEventListener('click', () => {
        const minutes = clampMinutes(parseInt(balloonMinutesInput.value || '3'));
        balloonMinutesInput.value = minutes;
        balloonDurationMs = minutes * 60 * 1000;

        currentBalloonType = getSelectedBalloonType();

        openBalloonScreen();
        renderBalloon(currentBalloonType);
        resetBalloonVisual();
        startBalloonGrowth();
      });

      balloonBtn.addEventListener('click', popBalloon);

      balloonRestart.addEventListener('click', () => {
        renderBalloon(currentBalloonType);
        resetBalloonVisual();
        startBalloonGrowth();
      });

      balloonBack.addEventListener('click', () => {
        cancelAnimationFrame(balloonRaf);
        closeCelebrate();
        balloonScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
      });

      celebrateClose.addEventListener('click', closeCelebrate);

      window.addEventListener('resize', () => {
        if (!celebrateOverlay.classList.contains('hidden')) resizeConfetti();
      });

    });
  </script>
</body>
</html>
