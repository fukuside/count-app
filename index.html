<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª</title>

  <!-- Webã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ -->
  <link rel="icon" type="image/png" sizes="192x192"
        href="./images/icons/atonankai-192.png">
  <link rel="apple-touch-icon" sizes="192x192"
        href="./images/icons/atonankai-192.png">
  <link rel="icon" type="image/png" sizes="512x512"
        href="./images/icons/atonankai-512.png">

  <!-- PWAç”¨ï¼ˆå¿…è¦ãªã‚‰ï¼‰ -->
  <link rel="manifest" href="./manifest.webmanifest">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PZZ71NWCL2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PZZ71NWCL2');
  </script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap"
    rel="stylesheet"
  >

  <style>
    body {
      font-family: 'M PLUS Rounded 1c', 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    .car-icon {
      transition: transform 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 0.8s ease-out;
      cursor: pointer;
    }
    .car-icon.departing {
      transform: translateX(150vw) rotate(10deg);
      opacity: 0;
    }
    .hidden {
      display: none;
    }
    .finish-popup {
      animation: bounce-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    @keyframes bounce-in {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>

<body class="bg-orange-50 text-gray-800 min-h-screen">
  <!-- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼ -->
  <div class="min-h-screen flex flex-col items-center justify-center px-4">

    <!-- ãƒ­ã‚´ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ -->
    <header class="mb-6">
      <img
        src="./images/logo/logo-atonankai-header.png"
        alt="ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª ãƒ­ã‚´"
        class="h-24 mx-auto"
      >
    </header>

    <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
    <div id="app-container" class="w-full max-w-md mx-auto">

      <!-- è¨­å®šç”»é¢ -->
      <div id="settings-screen" class="p-6 bg-white rounded-2xl shadow-lg space-y-6">
        <h1 class="text-2xl font-bold text-center text-amber-600">ã˜ã‚…ã‚“ã³</h1>
        <div>
          <label for="title-input" class="block text-sm font-medium text-gray-700 mb-1">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input type="text" id="title-input" placeholder="ä¾‹ï¼šã™ã¹ã‚Šã ã„" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500">
        </div>
        <div>
          <label for="photo-input" class="block text-sm font-medium text-gray-700 mb-1">ã—ã‚ƒã—ã‚“</label>
          <input type="file" id="photo-input" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100 cursor-pointer">
          <img id="photo-preview" class="hidden mt-4 rounded-lg max-h-40 mx-auto" src="" alt="Photo preview">
        </div>
        <div>
          <label for="count-input" class="block text-sm font-medium text-gray-700 mb-1">ãªã‚“ã‹ã„ï¼Ÿ</label>
          <div class="flex items-center justify-center space-x-4">
            <button id="decrement" class="px-4 py-2 bg-amber-400 text-white rounded-full font-bold text-lg">-</button>
            <input type="number" id="count-input" value="3" min="1" max="20" class="w-20 text-center text-xl font-bold border-transparent focus:outline-none focus:ring-0">
            <button id="increment" class="px-4 py-2 bg-amber-400 text-white rounded-full font-bold text-lg">+</button>
          </div>
        </div>
        <button id="start-btn" class="w-full py-3 bg-orange-500 text-white font-bold rounded-lg shadow-md hover:bg-orange-600 transition-colors text-lg">
          ã‚¹ã‚¿ãƒ¼ãƒˆï¼
        </button>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
      <div id="main-screen" class="hidden text-center">
        <h2 id="display-title" class="text-3xl font-bold mb-4 text-amber-700"></h2>
        <img id="display-photo" class="hidden mb-6 rounded-lg shadow-md max-h-60 mx-auto" src="" alt="Uploaded photo">
        <div id="car-container" class="flex flex-wrap justify-center items-center gap-4 mb-8">
          <!-- è»Šã‚¢ã‚¤ã‚³ãƒ³ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
        <button id="reset-btn" class="py-2 px-6 bg-white text-amber-600 border-2 border-amber-500 font-bold rounded-lg shadow-sm hover:bg-amber-50 transition-colors">
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>

      <!-- ãŠã—ã¾ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div id="finish-message" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="finish-popup bg-white p-12 rounded-3xl shadow-2xl text-center">
          <span class="text-6xl mb-4 inline-block">ğŸ‰</span>
          <p class="text-5xl font-bold text-orange-500">ãŠã—ã¾ã„ï¼</p>
        </div>
      </div>

    </div><!-- /#app-container -->

  </div><!-- â˜… ã“ã® </div> ãŒå…ƒã‚³ãƒ¼ãƒ‰ã§ã¯æŠœã‘ã¦ã„ã¾ã—ãŸ -->

  <!-- ===== ãƒ•ãƒƒã‚¿ãƒ¼å³ä¸‹ã®ãƒ­ã‚´ ===== -->
  <div id="logo-container"
    class="fixed bottom-20 right-4 flex items-center space-x-2 opacity-75">
    <img src="./Flogo2.png" alt="ãƒ­ã‚´" class="h-10 w-10 rounded-full object-cover">
    <p class="text-xs text-gray-600 font-semibold">ä¸€èˆ¬ç¤¾å›£æ³•äººç¦ç¥‰ã§ã¤ãªãŒã‚‹ä¼š</p>
  </div>

  <!-- ===== å•ã„åˆã‚ã›ãƒœã‚¿ãƒ³ ===== -->
  <button id="contactButton"
    class="fixed bottom-4 right-4 bg-yellow-200 border border-gray-300
         shadow-md px-4 py-2 rounded-lg text-sm z-50">
    å•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰
  </button>

  <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
  <div id="feedbackForm"
  class="fixed bottom-32 right-4 bg-white border border-gray-300 rounded-lg shadow-xl
         p-4 w-72 z-50 hidden">

    <h3 class="text-lg mb-3 font-bold">ãŠå•ã„åˆã‚ã›</h3>

    <form id="feedbackSubmitForm">
      <!-- ã©ã®ã‚¢ãƒ—ãƒªã‹ -->
      <label class="text-sm">ã‚¢ãƒ—ãƒªã‚’é¸æŠï¼ˆå¿…é ˆï¼‰</label>
      <select id="appName" required
        class="w-full border rounded px-2 py-1 mb-3 text-sm">
        <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª">ã‚ã¨ãªã‚“ã‹ã„ï¼Ÿã‚¢ãƒ—ãƒª</option>
        <option value="ãƒªãƒ•ãƒ¬ãƒŸãƒ¼">ãƒªãƒ•ãƒ¬ãƒŸãƒ¼</option>
        <option value="ã»ã‚ã‚¹ã‚¿">ã»ã‚ã‚¹ã‚¿</option>
        <option value="ã‚ã–ã›ãƒªãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼">ã‚ã–ã›ãƒªãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼</option>
      </select>

      <!-- ç¨®åˆ¥ -->
      <label class="text-sm">ç¨®åˆ¥</label>
      <select id="feedbackType"
        class="w-full border rounded px-2 py-1 mb-3 text-sm">
        <option>ãƒã‚°å ±å‘Š</option>
        <option>è¦æœ›</option>
        <option>è³ªå•</option>
        <option>ãã®ä»–</option>
      </select>

      <!-- å†…å®¹ -->
      <label class="text-sm">å†…å®¹</label>
      <textarea id="content"
        class="w-full border rounded px-2 py-1 mb-3 text-sm h-20"
        required></textarea>

      <!-- ãƒ¡ãƒ¼ãƒ«ï¼ˆä»»æ„ï¼‰ -->
      <label class="text-sm">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰</label>
      <input id="email" type="email"
        class="w-full border rounded px-2 py-1 mb-3 text-sm">

      <!-- é€ä¿¡ -->
      <button type="submit"
        class="w-full bg-orange-300 py-2 rounded-lg text-sm font-bold mb-2">
        é€ä¿¡
      </button>

      <button type="button" id="closeFeedback"
        class="w-full bg-gray-200 py-2 rounded-lg text-sm">
        é–‰ã˜ã‚‹
      </button>
    </form>

    <!-- é€ä¿¡å¾Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="feedbackThanks" class="hidden text-center">
      <p class="mb-4">é€ä¿¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
      <button type="button" id="closeThanks"
        class="w-full bg-gray-200 py-2 rounded-lg text-sm">
        é–‰ã˜ã‚‹
      </button>
    </div>
  </div>

  <!-- ===== ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¾¤ ===== -->
  <!-- å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ç”¨ -->
  <script>
    const contactButton = document.getElementById("contactButton");
    const feedbackForm = document.getElementById("feedbackForm");
    const closeFeedback = document.getElementById("closeFeedback");
    const feedbackSubmitForm = document.getElementById("feedbackSubmitForm");
    const feedbackThanks = document.getElementById("feedbackThanks");
    const closeThanks = document.getElementById("closeThanks");

    contactButton.addEventListener("click", () => {
      feedbackForm.classList.remove("hidden");
    });

    closeFeedback.addEventListener("click", () => {
      feedbackForm.classList.add("hidden");
    });

    feedbackSubmitForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const appName = document.getElementById("appName").value;
      const feedbackType = document.getElementById("feedbackType").value;
      const content = document.getElementById("content").value;
      const email = document.getElementById("email").value;

      if (!appName) {
        alert("ã‚¢ãƒ—ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const subject = encodeURIComponent(`[${appName}] å•ã„åˆã‚ã›: ${feedbackType}`);
      const body = encodeURIComponent(
        `ã‚¢ãƒ—ãƒªï¼š${appName}\nç¨®åˆ¥ï¼š${feedbackType}\n\nå†…å®¹ï¼š\n${content}\n\nãƒ¡ãƒ¼ãƒ«ï¼š${email || "æœªè¨˜å…¥"}`
      );

      window.location.href =
        `mailto:info.fukushi@allcare.co.jp?subject=${subject}&body=${body}`;

      feedbackSubmitForm.classList.add("hidden");
      feedbackThanks.classList.remove("hidden");
    });

    closeThanks.addEventListener("click", () => {
      feedbackForm.classList.add("hidden");
      feedbackSubmitForm.classList.remove("hidden");
      feedbackThanks.classList.add("hidden");
      feedbackSubmitForm.reset();
    });
  </script>

  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ç”¨ -->
  <script>
    // DOMè¦ç´ ã®å–å¾—
    const settingsScreen = document.getElementById('settings-screen');
    const mainScreen = document.getElementById('main-screen');
    const titleInput = document.getElementById('title-input');
    const countInput = document.getElementById('count-input');
    const startBtn = document.getElementById('start-btn');
    const displayTitle = document.getElementById('display-title');
    const carContainer = document.getElementById('car-container');
    const resetBtn = document.getElementById('reset-btn');
    const finishMessage = document.getElementById('finish-message');
    const decrementBtn = document.getElementById('decrement');
    const incrementBtn = document.getElementById('increment');
    const photoInput = document.getElementById('photo-input');
    const photoPreview = document.getElementById('photo-preview');
    const displayPhoto = document.getElementById('display-photo');
    const logoContainer = document.getElementById('logo-container');

    let remainingCount = 0;

    // ç•ªå·ä»˜ãã®ã‚†ã‚‹ã‹ã‚è»Šã®SVGã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function createCarSVG(number) {
      return `
      <svg viewBox="0 0 140 100" class="w-20 h-20 sm:w-24 sm:h-24">
        <g stroke-linecap="round" stroke-linejoin="round">
          <path
            d="M18 60
               Q20 40 40 35
               H85
               Q105 35 120 55
               Q124 60 122 70
               Q120 82 108 84
               H32
               Q20 82 18 72
               Q16 66 18 60
               Z"
            fill="currentColor"
            opacity="0.9"
          />
          <path
            d="M40 35
               Q55 18 75 18
               Q95 18 108 35"
            fill="none"
            stroke="currentColor"
            stroke-width="4"
            opacity="0.35"
          />
          <rect
            x="47"
            y="30"
            width="46"
            height="24"
            rx="10"
            ry="10"
            fill="none"
            stroke="#ffffff"
            stroke-width="2.2"
            opacity="0.7"
          />
          <circle cx="60" cy="43" r="9" fill="#ffffff" />
          <circle cx="80" cy="43" r="9" fill="#ffffff" />
          <circle cx="60" cy="43" r="4.8" fill="#333333" />
          <circle cx="80" cy="43" r="4.8" fill="#333333" />
          <path
            d="M63 53 Q70 57 77 53"
            fill="none"
            stroke="#ffffff"
            stroke-width="2.8"
          />
          <circle cx="42" cy="80" r="9.5" fill="#555555" />
          <circle cx="96" cy="80" r="9.5" fill="#555555" />
          <circle cx="42" cy="80" r="4.5" fill="#e5e5e5" opacity="0.85" />
          <circle cx="96" cy="80" r="4.5" fill="#e5e5e5" opacity="0.85" />
          <text
            x="50%"
            y="78%"
            text-anchor="middle"
            font-size="32"
            font-weight="bold"
            fill="#ffffff"
            stroke="#000000"
            stroke-width="2"
            style="font-family: 'M PLUS Rounded 1c', sans-serif;"
          >
            ${number}
          </text>
        </g>
      </svg>
      `;
    }

    const carColors = [
      'text-sky-300',
      'text-emerald-300',
      'text-amber-300',
      'text-pink-300',
      'text-violet-300',
      'text-lime-300',
      'text-orange-300',
      'text-teal-300'
    ];

    // å†™çœŸãŒé¸æŠã•ã‚ŒãŸã¨ãã®å‡¦ç†
    photoInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          photoPreview.src = e.target.result;
          photoPreview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // ã‚«ã‚¦ãƒ³ãƒˆå¢—æ¸›ãƒœã‚¿ãƒ³ã®å‡¦ç†
    decrementBtn.addEventListener('click', () => {
      let currentValue = parseInt(countInput.value);
      if (currentValue > countInput.min) {
        countInput.value = currentValue - 1;
      }
    });

    incrementBtn.addEventListener('click', () => {
      let currentValue = parseInt(countInput.value);
      if (currentValue < countInput.max) {
        countInput.value = currentValue + 1;
      }
    });

    // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç†
    startBtn.addEventListener('click', () => {
      const title = titleInput.value.trim() === '' ? 'ã‚ã¨' : titleInput.value;
      const count = parseInt(countInput.value);
      const photoSrc = photoPreview.src;

      if (count > 0) {
        setupMainScreen(title, count, photoSrc);
        settingsScreen.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        logoContainer.classList.add('hidden'); // ãƒ¡ã‚¤ãƒ³ç”»é¢ã§ã¯ãƒ­ã‚´ã‚’éè¡¨ç¤º
      }
    });

    // ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupMainScreen(title, count, photoSrc) {
      displayTitle.textContent = `${title} ã‚ã¨ ${count}ã‹ã„`;

      if (photoSrc && photoSrc !== window.location.href) {
        displayPhoto.src = photoSrc;
        displayPhoto.classList.remove('hidden');
      } else {
        displayPhoto.classList.add('hidden');
      }

      carContainer.innerHTML = '';
      remainingCount = count;

      for (let i = 0; i < count; i++) {
        const carWrapper = document.createElement('div');
        carWrapper.innerHTML = createCarSVG(i + 1);
        carWrapper.className = `car-icon ${carColors[i % carColors.length]}`;
        carWrapper.addEventListener('click', carClickListener);
        carContainer.appendChild(carWrapper);
      }
    }

    // è»Šã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
    function carClickListener(event) {
      const car = event.currentTarget;

      if (car.classList.contains('departing')) return;

      car.classList.add('departing');
      remainingCount--;

      setTimeout(() => {
        car.style.visibility = 'hidden';
      }, 800);

      if (remainingCount > 0) {
        const title = displayTitle.textContent.split(' ã‚ã¨')[0];
        displayTitle.textContent = `${title} ã‚ã¨ ${remainingCount}ã‹ã„`;
      } else {
        displayTitle.textContent = 'ã‚ˆãã§ãã¾ã—ãŸï¼';
        setTimeout(() => {
          finishMessage.classList.remove('hidden');
        }, 1000);
      }

      car.removeEventListener('click', carClickListener);
    }

    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç†
    resetBtn.addEventListener('click', () => {
      mainScreen.classList.add('hidden');
      settingsScreen.classList.remove('hidden');
      logoContainer.classList.remove('hidden');
      titleInput.value = '';
      photoInput.value = '';
      photoPreview.src = '';
      photoPreview.classList.add('hidden');
    });

    // ãŠã—ã¾ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
    finishMessage.addEventListener('click', () => {
      finishMessage.classList.add('hidden');
      mainScreen.classList.add('hidden');
      settingsScreen.classList.remove('hidden');
      logoContainer.classList.remove('hidden');
      titleInput.value = '';
      photoInput.value = '';
      photoPreview.src = '';
      photoPreview.classList.add('hidden');
    });
  </script>
</body>
</html>
